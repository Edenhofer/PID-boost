\chapter{Application}
\label{chap:application}

\section{Data sample}
\label{sec:data_sample}

As outlined in \autoref{subsec:particle_identification}, the main objective of particle identification at Belle~\RN{2} is to identifying tracks of kaons, pions, electrons, muons, protons and deuterons. In order to validate a particle identification approach and to make sure it is behaving as expected it is standard procedure to measure the performance on Monte Carlo simulated data. For the purpose of simulating the production and decay of the $\Upsilon(4S)$ the software framework EvtGen was used. The subsequent generic decay was simulated using generic decay files provided by the Belle~\RN{2} software. After the simulation of the particle and their various properties, the detector responses are emulated. Hits in the various detector components are simulated and at last the veracity of a track identification is calculated. For obvious reasons the process of matching the identification with the truth value is not possible for real data, however for testing purposes it is a valuable tool to measure and compare the performance of a new approach.

Throughout this thesis several decays will be discussed, most notably the decay of the charged $B$ mesons. $\Upsilon(4S)$ decays in $(51.4 \pm 0.6) \%$ of cases into the charged $B^+$ and $B^-$. Therefore it represents a good sample of the overall to be expected particle species. Observations seen in this generic charged decay were validated using data of the `mixed' decay into $B^0$ and $\bar{B}^0$ which has a branching ratio of $(48.6 \pm 0.6) \%$. Both samples are generic decays and not specific to one analysis. A complete list of possible decay-strings as well as the above mentioned branching fractions may be found in~\cite{Patrignani:2016xqp}.

Additional a simulated decay of the $B^+ B^-$ with non-generic properties was generated. The properties are outlined in \autoref{tab:simulated_decay}. It allowed for fast processing of tests due to its simplicity and helped in differentiating between decay specific observations and generic ones.

\begin{table}[ht]
	\centering
	\begin{tabular}{ll}
		$\Upsilon(4S) \rightarrow B^+ B^-$ & $1.$ \\
		\quad $B^+ \rightarrow \mu^+ \nu_{\mu} \gamma$ & $1.$ \\
		\quad $B^- \rightarrow \pi^- D^0$ & $1.$ \\
		\qquad $D^0 \rightarrow K^- \pi^+$ & $0.2$ \\
		\qquad 	$D^0 \rightarrow K^- \pi^+ \pi^0$ & $0.2$ \\
		\qquad 	$D^0 \rightarrow K^- \pi^+ \pi^+ \pi^-$ & $0.2$ \\
		\qquad 	$D^0 \rightarrow K^- K^+$ & $0.2$ \\
		\qquad 	$D^0 \rightarrow \pi^+ \pi^0$ & $0.2$ \\
	\end{tabular}
	\caption{Simulated non-generic decay of the $\Upsilon(4S)$ with charge conjugated decays implied.}
	\label{tab:simulated_decay}
\end{table}

As seen in \autoref{fig:true_particle_abundance} the decays are dominated by kaons and pions. However the overall distribution is much more peaked for the charged generic decay. Furthermore the non-generic sample decay features a feature a lot more $\mu^+$ relatively speaking in comparisons charged generic decay. The mixed generic decay has been disregarded for this plot due to its distinct similarity to the charged decay.

\begin{figure}[ht]
	\centering
	\subcaptionbox{Charged\label{fig:charged_decay_true_particle_abundance}}{
		\includegraphics[width=0.43\textwidth,height=\textheight,keepaspectratio]{{{../res/charged 01/General Purpose Statistics: True Particle Abundances in the K+-Data}}}
	}
	\hspace{2em}
	\subcaptionbox{Sample\label{fig:sample_decay_true_particle_abundance}}{
		\includegraphics[width=0.43\textwidth,height=\textheight,keepaspectratio]{{{../res/sample/General Purpose Statistics: True Particle Abundances in the K+-Data}}}
	}
	\caption{True particle abundance in various simulated decays with particle on the $x$-axis sorted by their frequency. \textit{NaN} stands for an invalid translation\protect\footnotemark from the particles' PDG code to an actual particle.}
	\label{fig:true_particle_abundance}
\end{figure}
\footnotetext{The error occurs due to the PDG code in the ROOT file being saved as \lstinline|float32| but some particle's code exceed the memory limit of $32$-bits. Notably, this effects the deuteron as well as its anti-particles.}

The generic decay files used in the following discussion (charged for exploration, mixed for validation) each feature about $100,000$ initial $B \bar{B}$ events and about ten times as many identified tracks. The non-generic decay contains $10,000$ initial events and about $40,000$ tracks.

If not specifically otherwise stated it shall be assumed that the graphs and visuals in the following paragraphs are based on the data from the generic charged decay.

\section{Particle identification variables}
\label{sec:pid_variables}

\subsection{Legacy PID}
\label{subsec:pid_variables_legacy_pid}

The current particle identification approach consists of variables calculated via ratios of likelihoods. A particle identification is performed by applying a selection, also called \textit{cut} on the variables.

As of \formatdate{28}{06}{2018} the current approach is to take the likelihood of the desired particle and divide it by itself plus the likelihood of the pion. To construct the ID of the pion the kaon likelihood is used as second term in the denominator. \autoref{tab:legacy_particleid_variables} shows the definition of the ID for each of the six particle species of interest. In the future it will be replaced by the pidProbability approach, described in \autoref{subsec:pid_variables_pidProbability}.

\begin{table}[ht]
	\centering
	\begin{tabular}{l|l}
		pionID & $\mathcal{L}_{\pi} / (\mathcal{L}_{\pi} + \mathcal{L}_{K})$ \\
		kaonID & $\mathcal{L}_{K} / (\mathcal{L}_{K} +\mathcal{L}_{\pi})$ \\
		protonID & $\mathcal{L}_{p} / (\mathcal{L}_{p} +\mathcal{L}_{\pi})$ \\
		electronID & $\mathcal{L}_{e} / (\mathcal{L}_{e} +\mathcal{L}_{\pi})$ \\
		muonID & $\mathcal{L}_{\mu} / (\mathcal{L}_{\mu} +\mathcal{L}_{\pi})$ \\
		deuteronID & $\mathcal{L}_{d} / (\mathcal{L}_{d} +\mathcal{L}_{\pi})$
	\end{tabular}
	\caption{Definition of the ParticleID variables currently used by default for particle identification.}
	\label{tab:legacy_particleid_variables}
\end{table}

Its identification rate for pions and kaons is therefore rather good as it able to properly differentiate both classes. However it has obvious limitations in identifying rare particles as the fraction will always be dominated by the high abundance of the pion. The difference in the TPR for identifying the kaon and the electron can be seen in \autoref{fig:legacy_pid_particle_identification}. Not only is does the TPR take a less steep ascent for the electron identification the PPV is also consistently lower.

\begin{figure}[ht]
	\centering
	\subcaptionbox{Kaon identification\label{fig:legacy_pid_kaon_identification}}{
		\includegraphics[width=0.4\textwidth,height=\textheight,keepaspectratio]{{{../res/charged 01/Particle ID Approach: K Identification}}}
	}
	\hspace{2em}
	\subcaptionbox{Electron identification\label{fig:legacy_pid_electron_identification}}{
		\includegraphics[width=0.4\textwidth,height=\textheight,keepaspectratio]{{{../res/charged 01/Particle ID Approach: e Identification}}}
	}
	\caption{Particle identification rates for the kaon and electron using the legacy PID approach, each showing the True Positive Rate (ROC curve) and the Positive Predicted Value depending on the False Positive Rate.}
	\label{fig:legacy_pid_particle_identification}
\end{figure}

This unbalanced classification is further emphasized by analyzing the identification efficiencies. The matrix shown in \autoref{fig:legacy_pid_epsilon_pid} clearly shows the bias of the classification towards kaons and pions.

\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth,height=0.3\textheight,keepaspectratio]{{{../res/charged 01/Particle ID Approach: Heatmap of epsilonPID Matrix for an exclusive Cut}}}
	\caption{Matrix of $\epsilon$ values for the legacy particle ID approach.}
	\label{fig:legacy_pid_epsilon_pid}
\end{figure}

\subsection{pidProbability}
\label{subsec:pid_variables_pidProbability}

\subsection{pidProbability goodness}
\label{subsec:pid_variables_pidProbability_goodness}

\section{Bayesian approach}
\label{sec:bayesian_approach}

\subsection{Simple Bayes}
\label{subsec:bayesian_approach_simple_bayes}

The goal of a Bayesian approach is to weight the particles' probability by their abundance in the sample. This process increases the likelihood of a particle being identified as belonging to a group with a higher abundance and decreases the likelihood of being identified as belonging to a group with a lower abundance. The approach depends on the detector yielding decay-agnostic results. Hence the detector shall be assumed to always output the likelihood of measuring the received signal given a specific particle hypothesis regardless of prior probabilities. Furthermore the approach assumes a bias towards one or a few particles in the sample since otherwise the a priori probabilities would be flat and therefore boil down to the same result.
Thankfully both of those hypothesis are given in the real world: The detector can be assumed to behaves independently of the relative particle abundance and the measured data usually shows a clear predominance of one or a few particle species.
This is not surprising in itself as the branching fractions are not equally distributed. Dictated by the laws of physics one particle species might be produced more frequently.

The absolute particle abundance of a sample taken from the Monte Carlo simulation of the charged decay of the $B$-mesons can be seen in \autoref{fig:charged_decay_true_particle_abundance}. In this example the bias towards pions and kaons can be clearly observed.

\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth,height=0.4\textheight,keepaspectratio]{{{../res/charged 01/Diff Statistics: K Identification via PID, via flat Bayes}}}
	\caption{Comparisons of PPV and TPR for the Bayesian and standard PID approach for identifying kaons. The upper graph shows both rates of each approach separately using different colors, while the lower visualizes the ratio between the PPV's respectively the TPR's.}
	\label{fig:diff_stats_K_identification_via_pid_via_flat_bayes}
\end{figure}

\autoref{fig:diff_stats_K_identification_via_pid_via_flat_bayes} shows a comparison of the standard PID approach to the discussed Bayesian one. Using the Bayesian approach for identifying particles yields a very high positive predicted values even for low false positive rates as the introduced bias in the particle classification can utilize the unbalanced abundances. Furthermore the true positive rate of the Bayesian approach has a much steeper increase in comparison to the PID's one. However it levels of quicker, indicating that it fails to identify a few particles even at a high false positive rate.
The described effect can be seen for every stable particle with an ID and is not limited to the kaon. However it serves as a good example as it provides sufficient statistics for a throughout analysis.

\begin{figure}[ht]
	\centering
	\includegraphics[width=\textwidth,height=0.4\textheight,keepaspectratio]{{{../res/charged 01/Diff Heatmap: Heatmap of epsilonPID Matrix for an exclusive Cut via PID, via simple Bayes}}}
	\caption{Comparisons of the row-wised normed confusion matrix for the Bayesian and standard PID approach.}
	\label{fig:diff_heatmap_via_pid_via_flat_bayes}
\end{figure}

The improvements in the identification efficiencies are less obvious for an exclusive cut on the identifying variables. However in general the Bayesian approach is less prone to confusing particle with one another as seen in \autoref{fig:diff_heatmap_via_pid_via_flat_bayes}.

\subsection{Univariate Bayes}
\label{subsec:bayesian_approach_univariate_bayes}

The univariate Bayesian approach adds an dependency to one detector variable to the previous simple Bayesian approach. Hence instead of having a probability which depends on only on the particle abundance and the signal, the univariate approach additionally varies the probability depending on e.g. the transverse momentum. The most sensible variables are among others are said transverse momentum $p_t$ and the angle between the track of the particle and the beampipe $\Theta$.

\subsection{Multivariate Bayes}
\label{subsec:bayesian_approach_multivariate_bayes}

\section{Neural network approach}
\label{sec:neural_network_approach}
